!function(t){t.fn.repeatable_fields=function(e){function r(e){t(c.wrapper,e).each(function(l,d){var u=this,f=t(u).find(c.container),h=t(u).find(c.dataset);t(f).children(c.template).hide().find(":input").each(function(){t(this).prop("disabled",!0)});var p=t(f).children(c.row).filter(function(){return!t(this).hasClass(c.template.replace(".",""))}).length;if(t(f).attr("data-row-count",p),t(u).off().on("click",c.add,function(e){if(e.stopImmediatePropagation(),"function"==typeof c.before_add&&c.before_add(f,h),t(f).children(c.row).find(c.fields).removeClass("ts-fonts-manager-required"),t(f).children(c.row).filter(function(){return!t(this).hasClass(c.template.replace(".",""))}).length>o(f,null,h,!1).rows)return TS_VCSC_SweetAlert({title:jQuery("#ts-fonts-manager-string-title").text(),text:"",html:jQuery("#ts-fonts-manager-string-nonewline").text(),type:"error",allowOutsideClick:!0,allowEscapeKey:!0,showConfirmButton:!1,showCancelButton:!1,showOtherButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33d33",otherButtonColor:"#d33d33",confirmButtonText:jQuery("#ts-fonts-manager-string-confirm").text(),cancelButtonText:jQuery("#ts-fonts-manager-string-cancel").text(),otherButtonText:jQuery("#ts-fonts-manager-string-understood").text(),closeOnConfirm:!0,closeOnCancel:!0},function(t){return!1}),!1;var n=t(t(f).children(c.template).clone().removeClass(c.template.replace(".",""))[0].outerHTML);t(n).find(":input").each(function(){t(this).prop("disabled",!1)});var a=t(n).show().appendTo(f);"function"==typeof c.after_add&&c.after_add(f,a,i,h),r(a)}),t(u).on("click",c.remove,function(e){e.stopImmediatePropagation();var r=t(this).parents(c.row).first(),n=jQuery("#ts-fonts-manager-string-delete").text(),a=r.find('input[type="text"][data-key="family"]').val();""==t.trim(a)&&(a=jQuery("#ts-fonts-manager-string-unknown").text()),"function"==typeof c.before_remove&&c.before_remove(f,r,h),TS_VCSC_SweetAlert({title:jQuery("#ts-fonts-manager-string-title").text(),text:"",html:n+"<br/><br/>"+a,type:"warning",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,showCancelButton:!0,showOtherButton:!1,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33d33",otherButtonColor:"#d33d33",confirmButtonText:jQuery("#ts-fonts-manager-string-confirm").text(),cancelButtonText:jQuery("#ts-fonts-manager-string-cancel").text(),otherButtonText:jQuery("#ts-fonts-manager-string-understood").text(),closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&(r.remove(),"function"==typeof c.after_remove&&c.after_remove(f,r,s,h))})}),!0===c.is_sortable&&void 0!==t.ui&&void 0!==t.ui.sortable){var m=null!==c.sortable_options?c.sortable_options:{};m.items=c.row,m.handle=c.move,m.opacity=.5,m.revert=250,m.update=function(t,e){o(f,null,h,!1)},m.start=function(e,r){n(f),t(r.item).addClass("ts-fonts-manager-moving")},m.stop=function(e,r){a(f),t(r.item).removeClass("ts-fonts-manager-moving")},t(u).find(c.container).sortable(m)}t(u).on("change keyup",c.fields,function(e){"true"==t(this).attr("data-required")&&"text"==t(this).attr("type")&&(""!=t(this).val()?t(this).removeClass("ts-fonts-manager-required"):t(this).addClass("ts-fonts-manager-required"))}),t(e).on("submittal",function(t){o(f,null,h,!0)})})}function n(e){t(e).children(c.row).find("input:radio").each(function(){t(this).prop("checked")?t(this).attr("data-checked","true"):t(this).attr("data-checked","false")})}function a(e){t(e).children(c.row).find("input:radio").each(function(){"true"==t(this).attr("data-checked")?t(this).prop("checked",!0).attr("checked","checked"):t(this).prop("checked",!1).removeAttr("checked")})}function o(e,r,n,a){var o=0,i=new Array,s=null,l=[],d=!0;return t(e).children(c.row).each(function(){if(!t(this).hasClass(c.template.replace(".",""))){s={},l=[],d=!0,t.each(t(this).find(c.fields),function(e,r){t(this).attr("name",t(this).attr("data-base").replace(c.row_count_placeholder,o)),"checkbox"==t(this).attr("type")?s[t(this).attr("data-key")]=t(this).prop("checked"):"radio"==t(this).attr("type")?t(this).prop("checked")&&(s[t(this).attr("data-key")]=t(this).val()):"path"==t(this).attr("data-key")?s[t(this).attr("data-key")]=encodeURIComponent(t(this).val()):"text"==t(this).attr("type")?s[t(this).attr("data-key")]=TS_Repeatable_Base64.encode(t(this).val().replace(/\"/g,"'")):s[t(this).attr("data-key")]=t(this).val(),s.variants="",s.enqueue="",s.external=!0,"true"==t(this).attr("data-required")&&(l.push(s[t(this).attr("data-key")]),""==t.trim(s[t(this).attr("data-key")])?t(this).addClass("ts-fonts-manager-required"):t(this).removeClass("ts-fonts-manager-required"))}),o++;for(var e in l)""==t.trim(l[e])&&(d=!1);d&&i.push(s)}}),t(e).attr("data-row-count",o),a?t(n).val(TS_Repeatable_Base64.encode(JSON.stringify(i))):o<2?t(e).children(c.row).find(c.move).hide():t(e).children(c.row).find(c.move).show(),{rows:i.length,data:i}}function i(t,e,r,n){o(t,e,n,!1)}function s(t,e,r,n){o(t,e,n,!1)}var l={wrapper:".wrapper",container:".container",placeholder:".placeholder",row:".row",add:".add",confirm:".confirm",remove:".remove",move:".move",template:".template",dataset:".dataset",fields:"input, textarea, select",is_sortable:!0,sortable_options:null,before_add:null,after_add:i,before_remove:null,after_remove:s,row_count_placeholder:"{{row-count-placeholder}}"},c=t.extend({},l,e);r(this)}}(jQuery);